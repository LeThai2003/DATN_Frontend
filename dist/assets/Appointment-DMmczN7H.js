import{k as i,a_ as fe,a$ as je,b0 as Ne,bV as Ce,ci as Se,bI as re,cj as we,ck as Ie,cl as ke,bJ as ae,b2 as G,cm as Te,cn as ze,b7 as Ee,co as Oe,c as z,cd as le,a as K,d as $e,o as Me,cg as Y,j as e,aO as J,h as Q,F as A,cp as U,cq as oe,c7 as De,cr as Fe,c9 as Re,cs as Ae,ct as ie,ca as Be,cu as _e,bq as F,cv as Le,cw as te,J as Ve,L as Ye,cx as He,S as qe,aN as Ge,Q as Pe,ch as se,M as q,N as We,cy as Xe,cz as Ke,b as Je}from"./index-9vhxH6Pd.js";import{B as Qe}from"./ButtonTurnBack-CQ8GiJ0X.js";import{p as Ue}from"./appointment.validate-DpA5iXkj.js";const X=i.createContext({}),Ze=n=>{const{antCls:r,componentCls:s,iconCls:o,avatarBg:l,avatarColor:d,containerSize:S,containerSizeLG:p,containerSizeSM:c,textFontSize:v,textFontSizeLG:y,textFontSizeSM:M,borderRadius:E,borderRadiusLG:w,borderRadiusSM:D,lineWidth:I,lineType:O}=n,f=(m,x,j)=>({width:m,height:m,borderRadius:"50%",[`&${s}-square`]:{borderRadius:j},[`&${s}-icon`]:{fontSize:x,[`> ${o}`]:{margin:0}}});return{[s]:Object.assign(Object.assign(Object.assign(Object.assign({},Ne(n)),{position:"relative",display:"inline-flex",justifyContent:"center",alignItems:"center",overflow:"hidden",color:d,whiteSpace:"nowrap",textAlign:"center",verticalAlign:"middle",background:l,border:`${Ce(I)} ${O} transparent`,"&-image":{background:"transparent"},[`${r}-image-img`]:{display:"block"}}),f(S,v,E)),{"&-lg":Object.assign({},f(p,y,w)),"&-sm":Object.assign({},f(c,M,D)),"> img":{display:"block",width:"100%",height:"100%",objectFit:"cover"}})}},et=n=>{const{componentCls:r,groupBorderColor:s,groupOverlapping:o,groupSpace:l}=n;return{[`${r}-group`]:{display:"inline-flex",[r]:{borderColor:s},"> *:not(:first-child)":{marginInlineStart:o}},[`${r}-group-popover`]:{[`${r} + ${r}`]:{marginInlineStart:l}}}},tt=n=>{const{controlHeight:r,controlHeightLG:s,controlHeightSM:o,fontSize:l,fontSizeLG:d,fontSizeXL:S,fontSizeHeading3:p,marginXS:c,marginXXS:v,colorBorderBg:y}=n;return{containerSize:r,containerSizeLG:s,containerSizeSM:o,textFontSize:Math.round((d+S)/2),textFontSizeLG:p,textFontSizeSM:l,groupSpace:v,groupOverlapping:-c,groupBorderColor:y}},ce=fe("Avatar",n=>{const{colorTextLightSolid:r,colorTextPlaceholder:s}=n,o=je(n,{avatarBg:s,avatarColor:r});return[Ze(o),et(o)]},tt);var st=function(n,r){var s={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&r.indexOf(o)<0&&(s[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(n);l<o.length;l++)r.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(n,o[l])&&(s[o[l]]=n[o[l]]);return s};const de=i.forwardRef((n,r)=>{const{prefixCls:s,shape:o,size:l,src:d,srcSet:S,icon:p,className:c,rootClassName:v,style:y,alt:M,draggable:E,children:w,crossOrigin:D,gap:I=4,onError:O}=n,f=st(n,["prefixCls","shape","size","src","srcSet","icon","className","rootClassName","style","alt","draggable","children","crossOrigin","gap","onError"]),[m,x]=i.useState(1),[j,$]=i.useState(!1),[B,t]=i.useState(!0),a=i.useRef(null),u=i.useRef(null),h=Se(r,a),{getPrefixCls:k,avatar:N}=i.useContext(re),b=i.useContext(X),_=()=>{if(!u.current||!a.current)return;const C=u.current.offsetWidth,g=a.current.offsetWidth;C!==0&&g!==0&&I*2<g&&x(g-I*2<C?(g-I*2)/C:1)};i.useEffect(()=>{$(!0)},[]),i.useEffect(()=>{t(!0),x(1)},[d]),i.useEffect(_,[I]);const P=()=>{(O==null?void 0:O())!==!1&&t(!1)},T=we(C=>{var g,V;return(V=(g=l??(b==null?void 0:b.size))!==null&&g!==void 0?g:C)!==null&&V!==void 0?V:"default"}),W=Object.keys(typeof T=="object"?T||{}:{}).some(C=>["xs","sm","md","lg","xl","xxl"].includes(C)),H=Ie(W),pe=i.useMemo(()=>{if(typeof T!="object")return{};const C=ke.find(V=>H[V]),g=T[C];return g?{width:g,height:g,fontSize:g&&(p||w)?g/2:18}:{}},[H,T]),R=k("avatar",s),Z=ae(R),[ue,he,ge]=ce(R,Z),xe=G({[`${R}-lg`]:T==="large",[`${R}-sm`]:T==="small"}),ee=i.isValidElement(d),be=o||(b==null?void 0:b.shape)||"circle",ve=G(R,xe,N==null?void 0:N.className,`${R}-${be}`,{[`${R}-image`]:ee||d&&B,[`${R}-icon`]:!!p},ge,Z,c,v,he),ye=typeof T=="number"?{width:T,height:T,fontSize:p?T/2:18}:{};let L;if(typeof d=="string"&&B)L=i.createElement("img",{src:d,draggable:E,srcSet:S,onError:P,alt:M,crossOrigin:D});else if(ee)L=d;else if(p)L=p;else if(j||m!==1){const C=`scale(${m})`,g={msTransform:C,WebkitTransform:C,transform:C};L=i.createElement(Te,{onResize:_},i.createElement("span",{className:`${R}-string`,ref:u,style:Object.assign({},g)},w))}else L=i.createElement("span",{className:`${R}-string`,style:{opacity:0},ref:u},w);return ue(i.createElement("span",Object.assign({},f,{style:Object.assign(Object.assign(Object.assign(Object.assign({},ye),pe),N==null?void 0:N.style),y),className:ve,ref:h}),L))}),ne=n=>{const{size:r,shape:s}=i.useContext(X),o=i.useMemo(()=>({size:n.size||r,shape:n.shape||s}),[n.size,n.shape,r,s]);return i.createElement(X.Provider,{value:o},n.children)},nt=n=>{var r,s,o,l;const{getPrefixCls:d,direction:S}=i.useContext(re),{prefixCls:p,className:c,rootClassName:v,style:y,maxCount:M,maxStyle:E,size:w,shape:D,maxPopoverPlacement:I,maxPopoverTrigger:O,children:f,max:m}=n,x=d("avatar",p),j=`${x}-group`,$=ae(x),[B,t,a]=ce(x,$),u=G(j,{[`${j}-rtl`]:S==="rtl"},a,$,c,v,t),h=ze(f).map((b,_)=>Ee(b,{key:`avatar-key-${_}`})),k=(m==null?void 0:m.count)||M,N=h.length;if(k&&k<N){const b=h.slice(0,k),_=h.slice(k,N),P=(m==null?void 0:m.style)||E,T=((r=m==null?void 0:m.popover)===null||r===void 0?void 0:r.trigger)||O||"hover",W=((s=m==null?void 0:m.popover)===null||s===void 0?void 0:s.placement)||I||"top",H=Object.assign(Object.assign({content:_},m==null?void 0:m.popover),{classNames:{root:G(`${j}-popover`,(l=(o=m==null?void 0:m.popover)===null||o===void 0?void 0:o.classNames)===null||l===void 0?void 0:l.root)},placement:W,trigger:T});return b.push(i.createElement(Oe,Object.assign({key:"avatar-popover-key",destroyOnHidden:!0},H),i.createElement(de,{style:P},`+${N-k}`))),B(i.createElement(ne,{shape:D,size:w},i.createElement("div",{className:u,style:y},b)))}return B(i.createElement(ne,{shape:D,size:w},i.createElement("div",{className:u,style:y},h)))},me=de;me.Group=nt;const rt=i.forwardRef((n,r)=>{var M,E,w,D,I,O,f,m,x;const s=z(le),o=K(),{control:l,handleSubmit:d,setValue:S,reset:p,formState:{errors:c,isSubmitting:v}}=$e({resolver:Me(Ue),defaultValues:{patientId:s==null?void 0:s.patientId,fullName:(s==null?void 0:s.fullName)||"",phoneNumber:(s==null?void 0:s.phoneNumber)||"",citizenId:(s==null?void 0:s.citizenId)||"",insuranceCode:(s==null?void 0:s.insuranceCode)||"",job:(s==null?void 0:s.job)||"",dob:(s==null?void 0:s.dob)||null,gender:(s==null?void 0:s.gender)||!0,address:(s==null?void 0:s.address)||"",emergencyContact:(s==null?void 0:s.emergencyContact)||""}});i.useEffect(()=>{s&&p({patientId:s.patientId,fullName:s.fullName||"",phoneNumber:s.phoneNumber||"",citizenId:s.citizenId||"",insuranceCode:s.insuranceCode||"",job:s.job||"",dob:s.dob||null,gender:s.gender??!0,address:s.address||"",emergencyContact:s.emergencyContact||""})},[s,p]);const y=j=>(o(Y.setNewPatientAppointment(j)),!0);return i.useImperativeHandle(r,()=>({submitForm:()=>new Promise(j=>{d($=>{o(Y.setNewPatientAppointment($)),j($)},$=>{console.warn("Validation errors:",$),j(null)})()})})),e.jsxs(J,{title:e.jsxs(e.Fragment,{children:["Thông tin người khám"," ",e.jsx("span",{className:"text-red-500 italic",children:"(Hãy điền đủ thông tin để chúng tôi hỗ trợ tốt nhất nhé!)"})]}),bodyStyle:{paddingTop:"10px"},children:[e.jsx("div",{className:"mb-2 flex justify-end",children:e.jsx(Q,{variant:"filled",color:"primary",onClick:()=>p(),children:"Hoàn tác"})}),e.jsx("form",{onSubmit:d(y),className:"flex flex-col gap-5 max-h-[450px] overflow-y-auto bg-slate-50 p-3 rounded-md",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(A,{name:"phoneNumber",control:l,label:"Số điện thoại",placeholder:"Nhập số điện thoại",inputType:"text",type:"input",error:!!c.phoneNumber,helperText:(M=c.phoneNumber)==null?void 0:M.message,required:!0}),e.jsx(A,{name:"fullName",control:l,label:"Họ và tên",placeholder:"Nhập họ và tên",inputType:"text",type:"input",error:!!c.fullName,helperText:(E=c.fullName)==null?void 0:E.message,required:!0}),e.jsx(A,{name:"dob",control:l,label:"Ngày sinh",placeholder:"Chọn ngày sinh",type:"datepicker",error:!!c.dob,helperText:(w=c.dob)==null?void 0:w.message,required:!0}),e.jsx(A,{name:"gender",control:l,label:"Giới tính",placeholder:"Chọn giới tính",type:"select",options:[{label:"Nam",value:!0},{label:"Nữ",value:!1}],error:!!c.gender,helperText:(D=c.gender)==null?void 0:D.message,required:!0}),e.jsx(A,{name:"citizenId",control:l,label:"CCCD/CMND",placeholder:"Nhập số CCCD/CMND",inputType:"text",type:"input",error:!!c.citizenId,helperText:(I=c.citizenId)==null?void 0:I.message,required:!0}),e.jsx(A,{name:"insuranceCode",control:l,label:"Mã bảo hiểm y tế",placeholder:"Nhập mã BHYT",inputType:"text",type:"input",error:!!c.insuranceCode,helperText:(O=c.insuranceCode)==null?void 0:O.message,required:!0}),e.jsx(A,{name:"job",control:l,label:"Nghề nghiệp",placeholder:"Nhập nghề nghiệp",inputType:"text",type:"input",error:!!c.job,helperText:(f=c.job)==null?void 0:f.message,required:!0}),e.jsx(A,{name:"emergencyContact",control:l,label:"SĐT liên hệ khẩn cấp",placeholder:"Nhập số điện thoại khẩn cấp",inputType:"text",type:"input",error:!!c.emergencyContact,helperText:(m=c.emergencyContact)==null?void 0:m.message,required:!0}),e.jsx(A,{name:"address",control:l,label:"Địa chỉ",placeholder:"Nhập địa chỉ",inputType:"text",type:"input",error:!!c.address,helperText:(x=c.address)==null?void 0:x.message,required:!0})]})})]})}),at=()=>e.jsxs("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-lg shadow-sm text-gray-800 inline-block",children:[e.jsx("h3",{className:"font-bold text-lg mb-2 text-yellow-700",children:"⚠️ Các bước đặt lịch khám:"}),e.jsxs("ol",{className:"space-y-1 list-decimal list-inside text-sm leading-relaxed",children:[e.jsxs("li",{children:["Kiểm tra ",e.jsx("span",{className:"font-semibold",children:"thông tin dịch vụ"}),"."]}),e.jsxs("li",{children:["Điền đầy đủ ",e.jsx("span",{className:"font-semibold",children:"thông tin người khám"})," và nhấn"]}),e.jsxs("li",{children:["Tích chọn ",e.jsx("span",{className:"font-semibold",children:"bác sĩ phụ trách"})," ở đầu dòng và chọn",e.jsx("span",{className:"font-semibold",children:" thời gian khám mong muốn"})," dưới bảng bác sĩ, sau đó nhấn","."]}),e.jsxs("li",{children:["Kiểm tra lại thông tin và nhấn",e.jsx("span",{className:"font-semibold text-yellow-700",children:' "Xác nhận"'})," để đến bước thanh toán."]})]})]}),lt=()=>{var r;const n=z(U);return e.jsx(J,{title:"Thông tin dịch vụ",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-5 max-h-[300px] overflow-y-auto",children:[(n==null?void 0:n.image)&&e.jsx("div",{className:"w-[220px] h-[150px] flex-shrink-0 rounded-xl overflow-hidden shadow-sm bg-gray-50 relative",children:e.jsx("img",{src:n.image,alt:n.name||"Service image",className:"absolute inset-0 w-full h-full object-cover"})}),e.jsxs("div",{className:"flex flex-col items-start gap-3 text-gray-700 leading-relaxed",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Tên dịch vụ:"})," ",n==null?void 0:n.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"Phí khám:"})," ",e.jsxs("span",{className:"text-primary font-medium",children:[(r=n==null?void 0:n.price)==null?void 0:r.toLocaleString("vi-VN")," ₫"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800 mb-1 text-left",children:"Mô tả:"}),e.jsx("p",{className:"whitespace-pre-line text-justify",children:n==null?void 0:n.description})]})]})]})})};F.extend(Xe);F.extend(Ke);F.locale("vi");const ot=()=>{var $,B;const n=K(),r=z(oe),s=z(U),o=z(De),l=z(Fe),d=z(Re),S=z(Ae),p=z(ie),[c,v]=i.useState((p==null?void 0:p.shiftTimeId)||null),[y,M]=i.useState((p==null?void 0:p.indexDate)||null);i.useEffect(()=>{n(Be())},[]),_e();const E=($=o==null?void 0:o.data)==null?void 0:$.map(t=>{const a=l==null?void 0:l.find(N=>{var b;return((b=N.shift)==null?void 0:b.id)===t.id}),u=a&&a.patientSlotBooked<a.patientSlot,h=F(d==null?void 0:d.time).format("YYYY-MM-DD")===F().format("YYYY-MM-DD");let k=!0;if(h){const N=F();F(`${d==null?void 0:d.time} ${t.startTime}`).isBefore(N)&&(k=!1)}return{...t,shiftId:a==null?void 0:a.id,isAvailable:u&&k}}),w=t=>{n(q.setShowModal({type:We.EMPLOYEE_CLIENT,variant:"view",data:t}))},D=t=>{var h,k;v(null),M(null);const a={...d,employeeIds:[t==null?void 0:t.employeeId]};n(se.setFilterShift(a));const u={employeeId:(t==null?void 0:t.employeeId)||"",fullname:(t==null?void 0:t.fullName)||"",avatar:(t==null?void 0:t.avatar)||"",specialization_name:((h=t==null?void 0:t.specialization)==null?void 0:h.name)||"",room_name:((k=t==null?void 0:t.roomDto)==null?void 0:k.name)||"",email:(t==null?void 0:t.email)||"",dob:(t==null?void 0:t.dob)||"",summary_profile:(t==null?void 0:t.profile)||""};n(Y.setNewDoctorAppointment(u))},I=t=>{M(t.value),v(null);const a=F(t.date).format("YYYY-MM-DD"),u={...d,time:a};n(se.setFilterShift(u))};i.useEffect(()=>{var t;((t=d.employeeIds)==null?void 0:t.length)>0&&n(Le(d))},[d,n]);const O=[{title:"",dataIndex:"radio",render:(t,a)=>e.jsx(He,{checked:a.employeeId===(r==null?void 0:r.employeeId),onChange:()=>D(a)}),width:60},{title:"Bác sĩ",dataIndex:"fullName",render:(t,a)=>e.jsxs(qe,{children:[a.avatar&&e.jsx(me,{src:a.avatar}),e.jsx("span",{children:t})]})},{title:"Chuyên khoa",dataIndex:["specialization","name"],width:200},{title:"Phòng khám",dataIndex:["roomDto","name"],width:230},{title:"Email",dataIndex:"email",width:200},{title:"Ngày sinh",dataIndex:"dob",render:t=>F(t).format("DD/MM/YYYY"),width:150},{title:"Hành động",key:"actions",width:130,align:"center",render:(t,a)=>(a==null?void 0:a.employee_id)==-1?null:e.jsx(Ge,{title:e.jsxs(e.Fragment,{children:["Thông tin chi tiết bác sĩ ",a==null?void 0:a.fullname]}),children:e.jsx(Q,{color:"primary",variant:"filled",icon:e.jsx(Pe,{}),onClick:()=>{w(a)},className:"",size:"small"})})}],f=F(),m=f.weekday();let x=[];if(m==6){const t=f;x=Array.from({length:8},(a,u)=>{const h=t.add(u,"day");return{value:u+2,label:te(h),date:h}})}else{const t=f.weekday(0);x=Array.from({length:7},(a,u)=>{const h=t.add(u,"day");return{value:u+2,label:te(h),date:h}})}const j=t=>{t.isAvailable&&(v(t.id),n(Y.setShiftAppointment({...p,shiftId:t==null?void 0:t.shiftId,shiftTimeId:t==null?void 0:t.id,startTime:t==null?void 0:t.startTime,endTime:t==null?void 0:t.endTime,date:(d==null?void 0:d.time)||"",indexDate:y})))};return e.jsxs(J,{title:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{children:"Chọn bác sĩ phụ trách và thời gian khám"})}),children:[e.jsx(Ve,{dataSource:(B=s==null?void 0:s.employeeDtos)==null?void 0:B.filter(t=>t.status!="DELETE"&&t.nameRole!="ROLE_ADMIN"),columns:O,rowKey:"employee_id",pagination:!1,scroll:{x:"max-content",y:"400px"}}),(r==null?void 0:r.employeeId)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4 mb-3",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-red-500 mr-1",children:"*"}),e.jsx("span",{className:"font-semibold text-gray-800",children:"Ngày khám"})]}),e.jsx("div",{className:"flex overflow-x-auto gap-2 p-2 bg-slate-50 rounded-md custom-scrollbar",children:x.map(t=>{const a=y===t.value,u=t.date.isBefore(F().startOf("day"));return e.jsx("div",{onClick:()=>!u&&I(t),className:`
                                            min-w-[160px] px-3 py-2 rounded-md cursor-pointer text-center 
                                            border transition-all duration-150
                                            ${a?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300"}
                                            ${!a&&!u?"hover:bg-blue-50 hover:border-blue-400":""}
                                            ${u?"opacity-40 cursor-not-allowed":""}
                                        `,children:e.jsx("div",{className:`text-sm ${a?"text-white":"text-gray-700"}`,children:t.label})},t.value)})})]}),y&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-red-500 mr-1",children:"*"}),e.jsx("span",{className:"font-semibold text-gray-800",children:"Giờ khám"})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2 p-2 bg-slate-50 rounded-md relative",children:[S&&e.jsx(Ye,{}),E==null?void 0:E.map(t=>{const a=c===t.id;return e.jsxs("div",{onClick:()=>t.isAvailable&&j(t),className:`
                                                px-3 py-1 rounded-md text-center border 
                                                transition-all duration-150 text-sm
                                                ${t.isAvailable?a?"bg-blue-600 text-white border-blue-600":"bg-white border-gray-300 text-gray-700 hover:bg-blue-50 hover:border-blue-400 cursor-pointer":"bg-gray-200 text-gray-500 border-gray-300 cursor-not-allowed"}
                                            `,children:[e.jsx("div",{className:`font-medium ${a?"text-white":"text-gray-700"}`,children:t.startTime}),e.jsx("div",{className:`text-xs mt-0.5 ${a?"text-blue-100":"text-gray-500"}`,children:t.endTime})]},t.id)})]})]})]})]})},mt=()=>{const n=z(U),r=z(oe),s=z(ie),o=z(le),l=K(),d=Je(),S=i.useRef(null),p=async()=>{const c=await S.current.submitForm();if(!c){console.log("Form chưa hợp lệ, vui lòng kiểm tra lại.");return}if(!c){l(q.setWarningMessage("Vui lòng nhập thông tin người khám bệnh."));return}if(!r){l(q.setWarningMessage("Vui lòng chọn bác sĩ."));return}if(!s){l(q.setWarningMessage("Vui lòng chọn giờ khám mong muốn!"));return}const v={...c,fullname:c==null?void 0:c.fullName,shiftId:s==null?void 0:s.shiftId,serviceId:n==null?void 0:n.serviceId,price:n==null?void 0:n.price};l(Y.setNewAppointment(v)),d("/checkout")};return e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"container",children:[e.jsx("div",{className:"absolute top-[80px] left-0 px-[15px]",children:e.jsx("div",{className:"flex items-center justify-start gap-3",children:e.jsx(Qe,{link:"/services"})})}),e.jsx("section",{className:"py-10 ",children:e.jsx("div",{className:"pt-[86px]",children:e.jsxs("div",{className:" flex flex-col gap-3",children:[e.jsx("h2",{className:"text-3xl font-bold mb-2 text-gray-800 mx-auto text-center",children:"Đặt lịch khám"}),e.jsx(lt,{}),e.jsx(at,{}),e.jsx(rt,{ref:S}),e.jsx(ot,{}),(r==null?void 0:r.employeeId)&&(s==null?void 0:s.shiftId)&&(o==null?void 0:o.patientId)&&e.jsx("div",{className:"flex items-center justify-end border-t border-gray-200 mt-4",children:e.jsx(Q,{type:"primary",size:"large",className:"mt-5 px-10",onClick:p,children:"Xác nhận"})})]})})})]})})};export{mt as default};
